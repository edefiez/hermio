{# Partial template for card list items - used for infinite scroll #}
{# Metadata for JavaScript (hidden) #}
{% if hasMore is defined and totalCards is defined %}
<div style="display:none;" data-has-more="{{ hasMore ? 'true' : 'false' }}" data-total-cards="{{ totalCards }}"></div>
{% endif %}

{% for card in cards %}
    <div class="col-md-6 col-12 mt-4 card-item">
        <div class="card">
            <div class="card-header bg-light">
                <h5 style="margin-top: 0; margin-bottom: 0;">
                    {{ card.content.name|default('card.unnamed'|trans) }}
                </h5>
                {% if card.content.title or card.content.company %}
                    <div class="text-muted" style="font-size: 0.9rem; margin-top: 0.25rem;">
                        {% if card.content.title %}
                            <span>{{ card.content.title }}</span>
                        {% endif %}
                        {% if card.content.title and card.content.company %}
                            <span> â€¢ </span>
                        {% endif %}
                        {% if card.content.company %}
                            <span>{{ card.content.company }}</span>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
            <div class="card-body">
                <p>
                    <strong>
                        <i class="fas fa-lock" style="color: #007bff;"></i>
                        {{ 'card.security.secure_url'|trans }}:
                    </strong><br>
                    <small style="word-break: break-all;">
                        <a href="{{ app.request.schemeAndHttpHost }}{{ card.publicUrl }}"
                           target="_blank"
                           rel="noopener noreferrer"
                           style="color: #007bff; text-decoration: none;"
                           title="{{ 'card.preview.open'|trans|default('Open card preview') }}">
                            {{ app.request.schemeAndHttpHost }}{{ card.publicUrl }}
                            <i class="fas fa-external-link-alt" style="font-size: 0.75em; margin-left: 3px;"></i>
                        </a>
                    </small>
                </p>
                {% if isEnterprise and cardAssignments[card.id] is defined and cardAssignments[card.id]|length > 0 %}
                    <p style="margin-top: 10px;">
                        <strong>{{ 'card.assignments.current'|trans }}:</strong>
                        {% for assignment in cardAssignments[card.id] %}
                            <span class="badge bg-info text-white" style="margin-right: 5px;" title="{{ 'team.members.assigned_by'|trans }}: {{ assignment.assignedBy.email }}">
                            {{ assignment.teamMember.email }}
                            <small>({{ assignment.teamMember.role.getDisplayName()|trans }})</small>
                        </span>
                        {% endfor %}
                    </p>
                {% elseif isEnterprise and canManageAssignments %}
                    <p style="margin-top: 10px; color: #6c757d; font-size: 14px;">
                        {{ 'card.assignments.none'|trans }}
                    </p>
                {% endif %}
                <p>
                    <small>{{ 'card.created_at'|trans }}: {{ card.createdAt|date('Y-m-d H:i:s') }}</small>
                </p>
                <div style="display: flex; gap: 10px; margin-top: 15px; justify-content: center; align-items: stretch;">
                    <a href="{{ path('app_card_edit', {id: card.id}) }}" class="btn btn-secondary" style="flex: 1; text-align: center;">{{ 'card.edit_button'|trans }}</a>
                    <a href="{{ path('app_card_qr_code', {id: card.id}) }}" class="btn btn-info" style="flex: 1; text-align: center;">{{ 'card.qr_code.view'|trans }}</a>
                    {% if card.user == app.user %}
                        <form method="post" action="{{ path('app_card_delete', {id: card.id}) }}" style="flex: 1;" onsubmit="return confirm('{{ 'card.delete.confirm'|trans }}');">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ card.id) }}">
                            <button type="submit" class="btn btn-danger" style="width: 100%; height: 100%;">{{ 'card.delete_button'|trans }}</button>
                        </form>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endfor %}
