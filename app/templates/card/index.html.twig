{% extends 'base.html.twig' %}

{% block title %}{{ 'card.list.title'|trans }} - Hermio{% endblock %}

{% block body %}
<div class="profile-container">
    <div class="profile-card">
        <h1>{{ 'card.list.title'|trans }}</h1>
        
        {% if canCreateMore %}
            <div style="margin-bottom: 30px;">
                <a href="{{ path('app_card_create') }}" class="btn btn-primary">{{ 'card.create.button'|trans }}</a>
            </div>
        {% else %}
            <div class="alert alert-warning">
                {{ 'card.quota.exceeded'|trans }}
                <a href="{{ path('app_account_my_plan') }}">{{ 'account.view_plan_details'|trans }}</a>
            </div>
        {% endif %}

        <div style="margin-bottom: 20px;">
            <p>
                <strong>{{ 'account.quota.usage'|trans }}:</strong> 
                {{ currentUsage }} / 
                {% if quotaLimit %}
                    {{ quotaLimit }} {{ 'account.quota.cards'|trans }}
                {% else %}
                    {{ 'account.quota.unlimited'|trans }}
                {% endif %}
            </p>
        </div>

        {% if cards|length > 0 %}
            <div style="display: grid; gap: 20px;">
                {% for card in cards %}
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #007bff;">
                        <h3 style="margin-top: 0;">
                            {{ card.content.name|default('card.unnamed'|trans) }}
                        </h3>
                        <p>
                            <strong>{{ 'card.public_url'|trans }}:</strong>
                            <a href="{{ card.publicUrl }}" target="_blank">{{ card.publicUrl }}</a>
                        </p>
                        <p>
                            <small>{{ 'card.created_at'|trans }}: {{ card.createdAt|date('Y-m-d H:i:s') }}</small>
                        </p>
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <a href="{{ path('app_card_edit', {id: card.id}) }}" class="btn btn-secondary">{{ 'card.edit'|trans }}</a>
                            <a href="{{ path('app_card_qr_code', {id: card.id}) }}" class="btn btn-info">{{ 'card.qr_code.view'|trans }}</a>
                            <form method="post" action="{{ path('app_card_delete', {id: card.id}) }}" style="display: inline;" onsubmit="return confirm('{{ 'card.delete.confirm'|trans }}');">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ card.id) }}">
                                <button type="submit" class="btn btn-danger">{{ 'card.delete'|trans }}</button>
                            </form>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-info">
                <p>{{ 'card.list.empty'|trans }}</p>
                {% if canCreateMore %}
                    <a href="{{ path('app_card_create') }}" class="btn btn-primary">{{ 'card.create.button'|trans }}</a>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

